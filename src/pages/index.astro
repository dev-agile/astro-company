---
import { Image } from "astro:assets";
import Base from "@/layouts/Base.astro";
import Cta from "@/layouts/components/Cta.astro";
import { markdownify } from "@/lib/utils/textConverter";
import { getEntryBySlug } from "astro:content";
import Button from "@/components/Button.astro";

const homepage = await getEntryBySlug("homepage", "index");
const { banner, feature, services, workflow, call_to_action, why_cognivac } =
  homepage.data;
---

<Base>
  <!-- banner -->
  <section
    class="section pb-[50px] bg-[#002145] relative z-10 max-h-[800px]"
    aria-labelledby="banner-title"
  >
    <div class="absolute inset-0 -z-10 h-full w-full">
      <Image
        src={banner?.image}
        alt="Banner Background"
        loading="lazy"
        class="object-cover h-full w-full"
        format="webp"
        width="1140"
        height="200"
        decoding="async"
      />
    </div>
    <div class="container max-w-[1140px]">
      <div class="row text-center">
        <div
          class="mx-auto lg:col-10 2xl:pt-20 xl:pt-20 xs:pt-4 sm:pt-8 md:pt-12 lg:pt-16"
        >
          {/* Banner Title */}
          <header>
            <h1
              id="banner-title"
              class="font-primary text-theme-light font-medium 2xl:text-[68px] 2xl:leading-[86px] xl:text-[68px] xl:leading-[86px] lg:text-[64px] lg:leading-[86px] md:text-[48px] md:leading-[68px] sm:text-[48px] sm:leading-[68px] xs:text-[36px] xs:leading-[60px]"
            >
              {banner?.title}
            </h1>
          </header>

          {/* Banner Content */}
          {
            banner?.content && (
              <article class="mt-4 text-theme-light font-thin text-8 md:text-7 sm:text-6 xs:text-[14px]">
                <p set:html={markdownify(banner.content)} />
              </article>
            )
          }

          {/* Banner Button */}
          {
            banner?.button?.enable && (
              <div class="mt-16 grid place-items-center">
                <Button
                  link={banner.button.link}
                  label={banner.button.label}
                  class="max-w-[248px] w-full sm:w-auto btn-light"
                />
              </div>
            )
          }

          {/* Banner Footer */}
          {
            banner?.footer && (
              <article class="mt-4 text-theme-light font-thin text-8 md:text-7 sm:text-6 xs:text-[12px]">
                <p>{markdownify(banner.footer.content)}</p>
              </article>
            )
          }
        </div>
      </div>
    </div>
  </section>

  <section class="container">
    <!-- Why cognivac -->
    <section class="flex mt-[152px] overflow-hidden">
      <picture
        class="max-h-fit max-w-[860px] relative rounded-[20px] mr-[44px] 2xl:grid xl:grid lg:grid md:grid xs:hidden"
      >
        <div
          class="absolute inset-0 bg-black rounded-[20px] max-h-[680px]"
          style="background: linear-gradient(230.22deg, rgba(0, 0, 0, 0) 23.2%, #000000 100.6%);"
        >
        </div>
        <Image
          src={why_cognivac.image}
          alt={"Why Cognivac"}
          width="860"
          height="680"
          class="object-cover h-[680px] w-[860] rounded-[20px]"
          decoding="async"
          format="webp"
        />
      </picture>
      <article
        class="max-w-full sm:max-w-full md:max-w-[50%] lg:max-w-[50%] xl:max-w-[50%] 2xl:max-w-[50%] 2xl:text-start xl:text-start lg:text-start md:text-start sm:text-center xs:text-center mt-2"
      >
        <span
          class="bg-[#DFEEFF] px-[27px] py-2 rounded-[26px] text-[#007AFF] font-semibold"
          >{markdownify(why_cognivac.chip.title)}</span
        >
        <h3
          class="mt-[18px] text-[21px] leading-[26px]
        sm:text-[28px] sm:leading-[30px]
        md:text-[32px] md:leading-[38px] md:mt-[28px]
        lg:text-[48px] lg:leading-[50px] lg:mt-[32px]
        xl:text-[56px] xl:leading-[58px] xl:mt-[36px]
        2xl:text-[64px] 2xl:leading-[70px] 2xl:mt-[55px]"
        >
          {markdownify(why_cognivac.title)}
        </h3>
        <p class="text-[20px] mt-5">{markdownify(why_cognivac.content)}</p>
        {
          why_cognivac?.button?.enable && (
            <div class="mt-20 grid 2xl:place-items-baseline xl:place-items-baseline lg:place-items-baseline md:place-items-baseline sm:place-items-center xs:place-items-center">
              <Button
                link={why_cognivac.button.link}
                label={why_cognivac.button.label}
                class="max-w-[248px] sm:w-auto btn-gradient"
              />
            </div>
          )
        }
      </article>
    </section>

    <!-- Services and Offering -->
    <section class="flex items-center justify-between mt-[114px]">
      <h2 class="2xl:max-w-[390px] 2xl:text-[64px] xl:max-w-[390px] xl:text-[64px] lg:max-w-[390px] lg:text-[54px] md:max-w-[280px] md:text-[44px] sm:max-w-[190px] sm:text-[34px] xs:max-w-[35%] xs:text-[28px]">{feature.title}</h2>
      <p class="2xl:max-w-[600px] xl:max-w-[600px] lg:max-w-[500px] md:max-w-[425px] sm:max-w-[45%] xs:max-w-[50%] text-5">
        {markdownify(feature!.content)}
      </p>
    </section>

    <!-- Features -->
    <section class="section bg-theme-dark">
      <div class="container max-w-full mx-0">
        <div
          class="mt-8 grid gap-x-8 2xl:gap-y-6 xl:gap-y-6 lg:gap-y-16 md:gap-y-4 sm:gap-y-16 xs:gap-y-16 place-items-start sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-3"
        >
          {
            // Need fixing for responsiveness
            feature!.features.map((item: any, i: number) => ( 
              <div class="feature-card rounded-xl bg-white text-left z-10 relative 2xl:px-[55px] 2xl:py-[60px] 2xl:h-[376px] 2xl:w-[480px] xl:h-fit xl:w-fit xl:px-[40px] xl:py-[30px] lg:w-fit lg:h-fit lg:px-[55px] lg:py-[60px]">
                <div class="absolute inset-0 -z-10">
                  <Image
                    src={feature?.card_bg}
                    alt="Banner Background"
                    loading="lazy"
                    class="object-cover rounded-xl"
                    format="webp"
                    width="530"
                    height="376"
                    decoding="async"
                  />
                </div>
                {item.icon && (
                  <Image alt={item.icon} src={item.icon} width={90} height={90} />
                )}
                <div class="mt-4">
                  <p
                    class="h5 text-[35px] font-semibold"
                    set:html={markdownify(item!.name)}
                  />
                  <p class="mt-3 text-lg">{item.content}</p>
                </div>
              </div>
            ))
          }
        </div>
      </div>
    </section>
  </section>
  <!-- Services -->
  {
    services!.map((service: any, index: number) => {
      const isOdd = index % 2 > 0;
      return (
        <section class={`section ${isOdd && "bg-theme-light"}`}>
          <div class="container">
            <div class="items-center gap-8 md:grid md:grid-cols-2">
              <div class={`service-carousel ${!isOdd && "md:order-2"}`}>
                {service!.images!.length > 1 ? (
                  <div class="swiper">
                    <div class="swiper-wrapper">
                      {service!.images?.map((image: string) => (
                        <div class="swiper-slide">
                          <Image
                            class="mx-auto"
                            src={image}
                            width={538}
                            height={328}
                            alt=""
                          />
                        </div>
                      ))}
                    </div>
                    <div class="pagination" />
                  </div>
                ) : (
                  <Image
                    class="mx-auto"
                    src={service!.images![0]}
                    width={538}
                    height={328}
                    alt=""
                  />
                )}
              </div>

              {/* Content */}
              <div
                class={`service-content mt-5 md:mt-0 ${!isOdd && "md:order-1"}`}
              >
                <h2 class="font-bold leading-[40px]">{service?.title}</h2>
                <p class="mt-4 mb-2">{service?.content}</p>
                {service?.button?.enable && (
                  <a
                    href={service?.button.link}
                    class="cta-link inline-flex items-center text-primary"
                  >
                    {service?.button.label}
                    <img
                      class="ml-1"
                      src="/images/arrow-right.svg"
                      width={18}
                      height={14}
                      alt="arrow"
                    />
                  </a>
                )}
              </div>
            </div>
          </div>
        </section>
      );
    })
  }

  <script>
    import { Swiper } from "swiper";
    import "swiper/css";
    import "swiper/css/pagination";
    import { Autoplay, Pagination } from "swiper/modules";

    // astro:page-load event is fired when the page is loaded
    document.addEventListener("astro:page-load", () => {
      new Swiper(".service-carousel .swiper", {
        modules: [Pagination, Autoplay],
        autoplay: {
          delay: 3000,
        },
        pagination: {
          type: "bullets",
          el: ".service-carousel .pagination",
          clickable: true,
        },
      });
    });
  </script>
  <!-- ./End service -->

  <!-- Workflow -->
  <section class="section pb-0">
    <div class="mb-8 text-center">
      <h2
        class="mx-auto max-w-[400px] font-bold leading-[44px]"
        set:html={workflow?.title}
      />
      <p class="mt-3" set:html={workflow?.description} />
    </div>
    <Image
      src={workflow!.image}
      alt="workflow image"
      width={1920}
      height={414}
    />
  </section>

  <!-- Call to Action -->
  <Cta cta={call_to_action} />
</Base>
